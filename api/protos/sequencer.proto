syntax = "proto3";

package mizer;

service SequencerApi {
  rpc GetSequences (GetSequencesRequest) returns (Sequences) {}
  rpc AddSequence (AddSequenceRequest) returns (Sequence) {}
  rpc SequenceGo (SequenceGoRequest) returns (EmptyResponse) {}
}

message GetSequencesRequest {}

message AddSequenceRequest {
}

message SequenceGoRequest {
  uint32 sequence = 1;
}

message EmptyResponse {}

message Sequences {
  repeated Sequence sequences = 1;
}

message Sequence {
  uint32 id = 1;
  string name = 2;
  repeated Cue cues = 3;
}

message Cue {
  uint32 id = 1;
  string name = 2;
  CueTrigger trigger = 3;
  bool loop = 4;
  repeated CueChannel channels = 5;
}

enum CueTrigger {
  GO = 0;
  FOLLOW = 1;
  BEATS = 2;
  TIMECODE = 3;
}

message CueChannel {
  repeated uint32 fixtures = 1;
  string channel = 2;
  CueValue value = 3;
  CueTimer fade = 4;
  CueTimer delay = 5;
}

message CueValue {
  oneof value {
    double direct = 3;
    CueValueRange range = 4;
  }
}

message CueTimer {
  bool hasTimer = 1;
  oneof timer {
    CueTime direct = 2;
    CueTimerRange range = 3;
  }
}

message CueValueRange {
  double from = 1;
  double to = 2;
}

message CueTime {
  oneof time {
    double seconds = 1;
    double beats = 2;
  }
}

message CueTimerRange {
  CueTime from = 1;
  CueTime to = 2;
}

